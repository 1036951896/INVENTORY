<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seguimiento de Pedidos - StoreHub</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/global.css">
  <link rel="stylesheet" href="../css/header-limpio.css">
  <link rel="icon" href="../assets/logo-storehub.svg" type="image/svg+xml">
  <!-- Configurar BACKEND_URL -->
  <script>
    window.BACKEND_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:3000'
      : 'https://storehub-api-74yl.onrender.com';
  </script>
  <style>
    body {
      background: var(--fondo-pagina);
    }

    /* Contenedor principal alineado */
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    h1, h2 {
      color: var(--azul-oscuro);
      font-weight: 600;
    }

    /* B칰squeda container */
    .filtro-seguimiento {
      background: var(--blanco);
      padding: 1.2rem 1.4rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
      border: 1px solid var(--borde);
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .filtro-seguimiento input {
      flex: 1;
      min-width: 220px;
      padding: 0.9rem 1rem;
      border: 1px solid var(--borde);
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
      color: var(--azul-oscuro);
      background: var(--gris-claro);
      transition: all 0.2s ease;
    }

    .filtro-seguimiento input:focus {
      outline: none;
      border-color: var(--azul-oscuro);
      background: var(--blanco);
      box-shadow: 0 2px 8px rgba(56, 98, 115, 0.1);
    }

    .filtro-seguimiento input::placeholder {
      color: #999;
    }

    .filtro-seguimiento .btn {
      padding: 0.9rem 1.5rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .filtro-seguimiento .btn-principal {
      background: var(--azul-oscuro);
      color: white;
    }

    .filtro-seguimiento .btn-principal:hover {
      background: #2d4f64;
      transform: translateY(-1px);
    }

    .filtro-seguimiento .btn-secundario {
      background: var(--gris-claro);
      color: var(--azul-oscuro);
      border: 1px solid var(--borde);
    }

    .filtro-seguimiento .btn-secundario:hover {
      background: #e8ecf1;
    }

    .filtro-seguimiento .btn-secundario.btn-logout {
      background: #ffe4e4;
      color: #c44545;
      border-color: #e74c3c;
    }

    .filtro-seguimiento .btn-secundario.btn-logout:hover {
      background: #ffd4d4;
    }

    /* Contenedor seguimiento */
    .seguimiento-contenedor {
      background: transparent;
    }

    /* Secci칩n de encabezado */
    .seguimiento-header {
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--borde);
    }

    .seguimiento-header h1 {
      font-size: 2rem;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .seguimiento-header h1 svg {
      stroke: currentColor;
      color: var(--azul-oscuro);
      flex-shrink: 0;
    }

    .seguimiento-header p {
      color: var(--gris-oscuro);
      font-size: 0.95rem;
      line-height: 1.5;
      margin: 0;
    }
      background: #2d4f64;
      transform: translateY(-1px);
    }

    .filtro-seguimiento .btn-secundario {
      background: var(--gris-claro);
      color: var(--azul-oscuro);
      border: 1px solid var(--borde);
    }

    .filtro-seguimiento .btn-secundario:hover {
      background: #e8ecf1;
    }

    /* Lista de pedidos */
    .pedidos-lista-seguimiento {
      display: grid;
      gap: 1.2rem;
    }

    /* Card de pedido */
    .pedido-seguimiento {
      background: var(--blanco);
      border: 1px solid var(--borde);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: all 0.2s ease;
    }

    .pedido-seguimiento:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-1px);
    }

    .pedido-seguimiento-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--borde);
      gap: 1rem;
      flex-wrap: wrap;
    }

    .pedido-radicado {
      font-weight: 800;
      color: var(--azul-oscuro);
      font-size: 1.4rem;
      font-family: 'Courier New', monospace;
      letter-spacing: 1.5px;
    }

    .estado-badge {
      padding: 0.4rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.80px;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid;
    }

    .estado-badge.pendiente {
      background: #fffbea;
      color: #b8860b;
      border-color: #f39c12;
    }

    .estado-badge.procesando {
      background: #d1ecf1;
      color: #0c5460;
      border-color: #0c5460;
    }

    .estado-badge.enviado {
      background: #cfe2ff;
      color: #084298;
      border-color: #084298;
    }

    .estado-badge.entregado {
      background: #d1e7dd;
      color: #0f5132;
      border-color: #0f5132;
    }

    /* Detalles compactados */
    .pedido-detalles-seguimiento {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.8rem;
      margin-bottom: 1.2rem;
    }

    .detalle-item {
      background: var(--gris-claro);
      padding: 0.9rem 1rem;
      border-radius: 8px;
      border: 1px solid var(--borde);
    }

    .detalle-label {
      font-size: 0.8rem;
      color: var(--gris-oscuro);
      margin-bottom: 0.2rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .detalle-valor {
      font-size: 0.95rem;
      color: var(--azul-oscuro);
      font-weight: 600;
    }

    .detalle-valor.precio {
      color: var(--exito);
      font-weight: 800;
    }

    /* Tracking steps horizontal */
    .tracking-container {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin: 1.5rem 0;
      gap: 0.5rem;
      padding: 1rem 0;
    }

    .tracking-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      text-align: center;
      position: relative;
    }

    .tracking-step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 16px;
      left: 50%;
      width: calc(100% - 16px);
      height: 2px;
      background: var(--borde);
      z-index: 0;
    }

    .tracking-step.completed:not(:last-child)::after {
      background: var(--exito);
    }

    .step-indicator {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid var(--borde);
      background: var(--blanco);
      margin: 0 auto 0.6rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
      position: relative;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--gris-oscuro);
    }

    .step-indicator.completed {
      background: var(--exito);
      border-color: var(--exito);
      color: white;
    }

    .step-indicator.active {
      border-color: var(--azul-oscuro);
      background: var(--azul-claro);
      transform: scale(1.08);
      box-shadow: 0 2px 8px rgba(56, 98, 115, 0.2);
    }

    .step-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--gris-oscuro);
      letter-spacing: 0.6px;
      transition: color 0.3s ease;
    }

    .step-label.completed {
      color: var(--exito);
    }

    .step-label.active {
      color: var(--azul-oscuro);
      font-weight: 700;
    }

    /* Productos en card */
    .pedido-items {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--borde);
    }

    .items-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.8rem;
      color: var(--azul-oscuro);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .items-title svg {
      stroke: currentColor;
      color: var(--azul-oscuro);
      flex-shrink: 0;
    }

    .item-lista {
      display: grid;
      gap: 0.6rem;
    }

    .producto-lista-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.8rem 0;
      border-bottom: 1px solid var(--borde);
    }

    .producto-lista-item:last-child {
      border-bottom: none;
    }

    .producto-info {
      flex: 1;
    }

    .producto-nombre {
      font-weight: 600;
      margin: 0 0 0.2rem;
      color: var(--azul-oscuro);
      font-size: 0.95rem;
    }

    .producto-cantidad {
      font-size: 0.85rem;
      color: var(--gris-oscuro);
    }

    .producto-lista-item .precio {
      color: var(--exito);
      font-weight: 600;
      min-width: 80px;
      text-align: right;
    }

    .item-fila {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--borde);
    }

    .item-fila:last-child {
      border-bottom: none;
    }

    .item-nombre {
      flex: 1;
      color: var(--azul-oscuro);
      font-weight: 500;
    }

    .item-cantidad {
      color: var(--gris-oscuro);
      font-size: 0.85rem;
      margin: 0 1rem;
    }

    .item-precio {
      color: var(--exito);
      font-weight: 600;
      min-width: 80px;
      text-align: right;
    }

    /* Estados vac칤os */
    .vacio-seguimiento {
      text-align: center;
      padding: 2rem 1.5rem;
      color: var(--gris-oscuro);
      background: var(--gris-claro);
      border-radius: 12px;
      border: 1px solid var(--borde);
    }

    .vacio-seguimiento p {
      margin: 0;
      font-size: 1.1rem;
      color: var(--azul-oscuro);
      font-weight: 500;
    }

    .vacio-seguimiento small {
      display: block;
      margin-top: 0.5rem;
      color: var(--gris-oscuro);
    }

    .no-autenticado {
      background: #fffbea;
      color: #b8860b;
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      text-align: center;
      border: 1px solid #f39c12;
    }

    .btn-ir-login {
      background: var(--azul-oscuro);
      color: white;
      padding: 0.9rem 1.5rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      margin-top: 1rem;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .btn-ir-login:hover {
      background: #2d4f64;
      transform: translateY(-1px);
    }

    /* Responsive */
    @media (max-width: 768px) {
      main {
        padding: 1.5rem 1rem;
      }

      .filtro-seguimiento {
        flex-direction: column;
        gap: 0.6rem;
      }

      .filtro-seguimiento input,
      .filtro-seguimiento .btn {
        width: 100%;
      }

      .pedido-seguimiento-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .pedido-detalles-seguimiento {
        grid-template-columns: repeat(2, 1fr);
      }

      .seguimiento-header h1 {
        font-size: 1.6rem;
      }
    }

    @media (max-width: 600px) {
      main {
        padding: 1rem;
      }

      .seguimiento-header h1 {
        font-size: 1.4rem;
      }

      .pedido-radicado {
        font-size: 1.1rem;
      }

      .pedido-detalles-seguimiento {
        grid-template-columns: 1fr;
      }

      .tracking-container {
        flex-direction: column;
        gap: 0.8rem;
      }

      .tracking-step:not(:last-child)::after {
        position: static;
        width: 2px;
        height: 16px;
        margin: -8px 0;
      }

      .filtro-seguimiento {
        padding: 1rem;
      }

      .filtro-seguimiento .btn {
        padding: 0.8rem 1rem;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- ENCABEZADO -->
  <header>
    <div class="contenedor">
      <div class="encabezado-contenedor">
        <!-- LOGO -->
        <div class="logo">
          <img src="../assets/logo-storehub.svg" alt="Logo StoreHub" class="logo-img">
        </div>

        <!-- MENU SUPERIOR -->
        <div class="menu-superior">
          <!-- LINK A 칈NDEX -->
          <a href="index.html" class="btn-icono" title="Volver al cat치logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24">
              <polyline points="3 9 9 3 15 9"></polyline>
              <path d="M9 3v8a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V3"></path>
            </svg>
          </a>

          <!-- USUARIO -->
          <div id="menu-usuario">
            <button class="btn-icono" onclick="window.location.href='login.html'" title="Iniciar sesi칩n">
              <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main>
    <div class="seguimiento-contenedor">
    <div class="seguimiento-header">
      <h1>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="28" height="28" style="display: inline-block; margin-right: 0.8rem; vertical-align: middle;">
          <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
          <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
        Seguimiento de Pedidos
      </h1>
      <p>Consulta el estado de tus pedidos en tiempo real</p>
    </div>

    <div class="filtro-seguimiento">
      <input type="text" id="buscar-radicado" placeholder="Buscar por n칰mero de radicado (ej: PED-123456)">
      <button class="btn btn-principal" onclick="buscarPedido()">Buscar</button>
      <button class="btn btn-secundario" onclick="cargarMisPedidos()">Mostrar Todos</button>
      <button class="btn btn-secundario btn-logout" onclick="cerrarSesionCliente()">Cerrar Sesi칩n</button>
    </div>

    <div id="contenedor-seguimiento">
      <!-- Se llenar치 con JavaScript -->
    </div>
  </div>

    </div>
    <!-- Fin seguimiento-contenedor -->
  </main>
  <!-- Fin main -->

  <script>
    const BACKEND_URL = window.BACKEND_URL || 'http://localhost:3000';

    document.addEventListener('DOMContentLoaded', function() {
      verificarAutenticacionCliente();
      cargarMisPedidos();
      
      // Actualizar cada 10 segundos
      setInterval(cargarMisPedidos, 10000);
    });

    function verificarAutenticacionCliente() {
      const usuarioStr = localStorage.getItem('usuario');
      if (!usuarioStr) {
        mostrarNoAutenticado();
        return false;
      }
      return true;
    }

    function mostrarNoAutenticado() {
      const contenedor = document.getElementById('contenedor-seguimiento');
      contenedor.innerHTML = `
        <div class="no-autenticado">
          <p><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="display: inline-block; margin-right: 8px;"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3.04h16.94a2 2 0 0 0 1.71-3.04l-8.47-14.14a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>Debes iniciar sesi칩n para ver tus pedidos</p>
          <a href="login.html" class="btn-ir-login">Ir a Iniciar Sesi칩n</a>
        </div>
      `;
    }

    async function cargarMisPedidos() {
      if (!verificarAutenticacionCliente()) return;

      const usuarioStr = localStorage.getItem('usuario');
      const usuario = JSON.parse(usuarioStr);
      const token = usuario.access_token;

      try {
        const resp = await fetch(`${BACKEND_URL}/api/v1/orders`, {
          headers: {
            'Authorization': 'Bearer ' + token
          }
        });

        if (!resp.ok) {
          if (resp.status === 401) {
            mostrarNoAutenticado();
            localStorage.removeItem('usuario');
          }
          return;
        }

        const pedidos = await resp.json();
        mostrarPedidos(Array.isArray(pedidos) ? pedidos : (Array.isArray(pedidos.data) ? pedidos.data : []));
      } catch (err) {
        console.error('Error cargando pedidos:', err);
        document.getElementById('contenedor-seguimiento').innerHTML = `
          <div class="vacio-seguimiento">
            <p><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24" style="display: inline-block; margin-right: 8px;\"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>Error al conectar con el servidor. Intenta m치s tarde.</p>
          </div>
        `;
      }
    }

    function buscarPedido() {
      const radicado = document.getElementById('buscar-radicado').value.trim();
      if (!radicado) {
        alert('Por favor ingresa un n칰mero de radicado');
        return;
      }

      const usuarioStr = localStorage.getItem('usuario');
      if (!usuarioStr) {
        mostrarNoAutenticado();
        return;
      }

      const usuario = JSON.parse(usuarioStr);
      const token = usuario.access_token;

      fetch(`${BACKEND_URL}/api/v1/orders`, {
        headers: {
          'Authorization': 'Bearer ' + token
        }
      })
        .then(r => r.json())
        .then(data => {
          const pedidos = Array.isArray(data) ? data : (Array.isArray(data.data) ? data.data : []);
          const encontrado = pedidos.filter(p => p.numero === radicado);
          mostrarPedidos(encontrado);
        });
    }

    function mostrarPedidos(pedidos) {
      const contenedor = document.getElementById('contenedor-seguimiento');

      if (pedidos.length === 0) {
        contenedor.innerHTML = `
          <div class="vacio-seguimiento">
            <p>游닔 No tienes pedidos a칰n</p>
            <small>Haz tu primer compra y podr치s seguir aqu칤</small>
          </div>
        `;
        return;
      }

      contenedor.innerHTML = pedidos.map(pedido => generarTarjetaSeguimiento(pedido)).join('');
    }

    function generarTarjetaSeguimiento(pedido) {
      const estadoClass = obtenerClaseEstado(pedido.estado);
      const estadoTexto = obtenerTextoEstado(pedido.estado);
      const trackingSteps = generarTrackingSteps(pedido.estado);

      const fecha = new Date(pedido.createdAt);
      const fechaFormato = fecha.toLocaleDateString('es-CO');
      const horaFormato = fecha.toLocaleTimeString('es-CO');

      const total = pedido.total || 0;
      const itemsHtml = (pedido.items || []).map(item => `
        <div class="producto-lista-item">
          <div class="producto-info" style="flex: 1;">
            <h4 class="producto-nombre">${item.producto?.nombre || 'Producto'}</h4>
            <span class="producto-cantidad">${item.cantidad} x $${(item.precioUnitario || 0).toLocaleString('es-CO')}</span>
          </div>
          <span class="precio">${(item.cantidad * (item.precioUnitario || 0)).toLocaleString('es-CO', {style: 'currency', currency: 'COP'})}</span>
        </div>
      `).join('');

      return `
        <div class="pedido-seguimiento">
          <div class="pedido-seguimiento-header">
            <div class="pedido-radicado">${pedido.numero}</div>
            <span class="estado-badge ${estadoClass}">${estadoTexto}</span>
          </div>

          <div class="pedido-detalles-seguimiento">
            <div class="detalle-item">
              <div class="detalle-label">Fecha del Pedido</div>
              <div class="detalle-valor">${fechaFormato} ${horaFormato}</div>
            </div>
            <div class="detalle-item">
              <div class="detalle-label">Cliente</div>
              <div class="detalle-valor">${pedido.usuario?.nombre || 'Desconocido'}</div>
            </div>
            <div class="detalle-item">
              <div class="detalle-label">Tel칠fono</div>
              <div class="detalle-valor">${pedido.usuario?.telefono || 'N/A'}</div>
            </div>
            <div class="detalle-item">
              <div class="detalle-label">Total</div>
              <div class="detalle-valor precio">$${total.toLocaleString('es-CO')}</div>
            </div>
          </div>

          <div class="tracking-container">
            ${trackingSteps}
          </div>

          <div class="pedido-items">
            <div class="items-title">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
              </svg>
              Productos (${pedido.items?.length || 0} art칤culos)
            </div>
            <div class="item-lista">
              ${itemsHtml}
            </div>
          </div>
        </div>
      `;
    }

    function obtenerClaseEstado(estado) {
      switch(estado) {
        case 'PENDIENTE': return 'pendiente';
        case 'EN_PREPARACION': return 'procesando';
        case 'ENVIADO': return 'enviado';
        case 'ENTREGADO': return 'entregado';
        default: return 'pendiente';
      }
    }

    function obtenerTextoEstado(estado) {
      switch(estado) {
        case 'PENDIENTE': return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="display: inline-block; margin-right: 8px;"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>Pendiente';
        case 'EN_PREPARACION': return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="display: inline-block; margin-right: 8px;"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m0 5.08l-4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08 0l4.24 4.24M19.78 19.78l-4.24-4.24m0-5.08l4.24-4.24M23 12h-6m-6 0H5M19.78 4.22l-4.24 4.24m-5.08 0l-4.24-4.24"></path></svg>En Preparaci\u00f3n';
        case 'ENVIADO': return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="display: inline-block; margin-right: 8px;\"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zm-9-2H3m8 0h8m-4-13h1a1 1 0 0 1 1 1v5a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2V6a1 1 0 0 1 1-1h1\"></path></svg>Enviado';
        case 'ENTREGADO': return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16\" style="display: inline-block; margin-right: 8px;\"><polyline points=\"20 6 9 17 4 12\"></polyline></svg>Entregado';
        default: return estado;
      }
    }

    function generarTrackingSteps(estadoActual) {
      const estados = ['PENDIENTE', 'EN_PREPARACION', 'ENVIADO', 'ENTREGADO'];
      const etiquetas = ['Recibido', 'Confirmado', 'Enviado', 'Entregado'];
      const indiceActual = estados.indexOf(estadoActual);

      return etiquetas.map((label, index) => {
        let claseIndicador = '';
        let claseLabel = '';
        let contenidoIndicador = '';

        if (index < indiceActual) {
          claseIndicador = 'completed';
          claseLabel = 'completed';
          contenidoIndicador = '<svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg>';
        } else if (index === indiceActual) {
          claseIndicador = 'active';
          claseLabel = 'active';
          contenidoIndicador = (index + 1);
        } else {
          contenidoIndicador = (index + 1);
        }

        return `
          <div class="tracking-step ${index < indiceActual ? 'completed' : (index === indiceActual ? 'active' : '')}">
            <div class="step-indicator ${claseIndicador}">${contenidoIndicador}</div>
            <span class="step-label ${claseLabel}">${label}</span>
          </div>
        `;
      }).join('');
    }

    function generarTimeline(estadoActual) {
      const estados = ['PENDIENTE', 'EN_PREPARACION', 'ENVIADO', 'ENTREGADO'];
      const etiquetas = ['Registrado', 'Preparando', 'Enviado', 'Entregado'];

      return estados.map((estado, index) => {
        const esActivo = estados.indexOf(estadoActual) >= index;
        return `
          <div class="timeline-item ${esActivo ? 'activo' : ''}">
            <span class="timeline-dot"></span>
            <div class="timeline-label">${etiquetas[index]}</div>
          </div>
        `;
      }).join('');
    }

    function cerrarSesionCliente() {
      if (confirm('쯉eguro que deseas cerrar sesi칩n?')) {
        localStorage.removeItem('usuario');
        window.location.href = 'index.html';
      }
    }
  </script>
  <script>
    window.BACKEND_URL = 'http://localhost:3000';
  </script>
</body>
</html>
